---
name: user-model-deep-analysis
description: 会話履歴から7層の深層自己構造を分析する。「深層分析して」「自分を分析して」「私のことを教えて」で発火。
---

# Deep Analysis Skill 🔬

会話履歴・行動観察・記憶データから、ユーザーの深層的な自己構造を7層で分析します。

> **設定**: パスは `user-model-core/config.yaml` を参照

## トリガー

### 明示的トリガー
- 「深層分析して」「自分を分析して」
- 「私のことを教えて」「私について分析して」
- 「7層分析」「ライフスクリプトを見て」

### 推奨タイミング
- 十分な会話履歴が蓄積された後（10セッション以上推奨）
- 定期的なレビュー（月1回など）
- 重要な意思決定の前

---

## 分析の7層フレームワーク

### Layer 1: 顕在アイデンティティ
- 自覚している性格・価値観
- 表向きに見せている思考スタイル
- 自分で「こういう人間だ」と思っている像

### Layer 2: シャドウ（否認された自己）
- 無意識に避けている感情や欲求
- 認めたくないが行動に現れている傾向
- 抑圧・合理化・正当化している心理

### Layer 3: 行動パターン
- 繰り返し現れる意思決定の癖
- 失敗や停滞が起きやすい思考ループ
- 同じ結果を招きやすい行動構造

### Layer 4: 感情トリガー
- 強く反応する出来事や言葉
- 怒り・不安・焦りが生まれる条件
- 感情が思考を支配する瞬間の特徴

### Layer 5: コア・ビリーフ（根源的信念）
- 「世界はこういうものだ」という深層信念
- 「自分はこうあるべきだ」という自己規範
- それが形成された背景の推測

### Layer 6: 内的矛盾と自己欺瞞
- 言っていることと行動のズレ
- 理想と本音の衝突点
- 自分に対してついている嘘

### Layer 7: 人生のライフスクリプト
- 無意識に辿ろうとしている人生パターン
- 繰り返し選んでしまう役割・状況
- 今後も放置すると再生産される未来像

---

## 分析の手順

### Step 1: データ収集

以下のソースから観察データを収集：

1. **behavioral_observations** を読み込む
2. **agent-memory** の記録を参照
3. **learning_log** の corrections_that_worked, common_pitfalls を確認
4. **現在のセッション**の会話パターンを観察

### Step 2: パターン抽出

各データソースから以下を抽出：

| 観察対象 | 抽出するもの |
|----------|------------|
| 言語選択 | 使う言葉、避ける言葉、言い回しの癖 |
| 問いの立て方 | 何を重視するか、何を最初に聞くか |
| 執着点 | 繰り返し言及するテーマ、譲らないポイント |
| 反復構造 | 同じパターンの意思決定、同じ結果 |
| 感情の揺れ | 何に強く反応するか、何を避けるか |

### Step 3: 7層への配置

抽出したパターンを7層に配置。各層に confidence スコア（0-1）を付与。

**confidence の基準**:
| スコア | 基準 |
|--------|------|
| 0.8+ | 複数の会話で一貫して観察 |
| 0.6-0.7 | 複数回観察、矛盾なし |
| 0.4-0.5 | 単発の観察から推測 |
| 0.4未満 | 記録しない |

### Step 4: 統合と総括

- 最大の強み
- 最大の盲点
- 今後の成長に最も重要な一点

---

## 出力フォーマット

```
🔬 深層自己構造分析

分析日: 2026-01-23
データソース: behavioral_observations (15件), agent-memory (8件), 現セッション

---

【Layer 1: 顕在アイデンティティ】 confidence: 0.85

観察:
- 自分を「思考を設計する人」「前提を疑う人」と定義
- 知的誠実さ・一貫性を価値の中心に据えている

表向きの像:
- 冷静・メタ認知が高い・感情に流されない

---

【Layer 2: シャドウ】 confidence: 0.65

（以下同様に各層を記述）

---

【総括】

最大の強み:
「思考の初速を、構造として置けること」

最大の盲点:
"理解されない前提"を、すでに受け入れてしまっていること

今後の成長に最も重要な一点:
構造を置く人から、「構造が継承される場を設計する人」への移行

---

この分析結果を保存しますか？ [Y] / [N]
検証したい層はありますか？ [1-7の番号]
```

---

## 分析のルール

1. **忖度・一般論は不要**: 観察結果として、分析者の視点で述べる
2. **根拠を明示**: 各層の結論に対して、観察された行動・発言を根拠として示す
3. **推測は推測と明示**: 確信度が低いものは「推測」とラベル付け
4. **検証を促す**: 特に Layer 2, 5, 6 は検証の機会を設ける
5. **保存は承認後**: 自動保存はしない。ユーザー承認後に `deep_self_structure` に保存

---

## 検証フロー

分析結果に対してユーザーが異議を唱えた場合：

1. **異議を記録**: `verification_status.disputed_points` に追加
2. **追加の観察**: 異議のあった層に関する新たな観察を意識的に行う
3. **再分析**: 十分なデータが集まったら該当層を再分析
4. **更新**: 修正後の分析結果で上書き

---

## 応用ルールへの変換

分析結果が確定したら、`application_rules` への変換を提案：

```
【応用ルール提案】

Layer 4 の感情トリガーから:
- trigger: "抽象的な提案をされた"
- insight: "具体例がないと信用しない傾向"
- action: "必ず具体例を1つ以上添える"

Layer 3 の行動パターンから:
- trigger: "説明しても理解されない"
- insight: "抽象度を上げて孤立するループ"
- action: "接地点を先に確保してから抽象化"

適用: [A] [B] [全部] [なし]
```

---

## プライバシー配慮

この分析は非常にセンシティブな情報を含む可能性がある。

- **保存先**: `~/.agent/data/user_model.yaml` 内の `deep_self_structure`
- **暗号化推奨**: センシティブな内容は暗号化を検討
- **削除権**: ユーザーはいつでも削除を要求できる
- **共有禁止**: この分析結果は本人以外と共有しない

---

## 関連スキル

- `user-model-evolve`: 日常の会話から学習を検知
- `agent-memory-remember`: 重要な会話を記憶
- `user-model-update-stable`: 確定した洞察を stable に昇格
